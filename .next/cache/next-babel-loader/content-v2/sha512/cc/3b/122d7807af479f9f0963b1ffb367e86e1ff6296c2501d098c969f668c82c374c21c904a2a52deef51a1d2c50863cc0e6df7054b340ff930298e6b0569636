{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/trevorb/Documents/VSCode Projects/trendtubes/auth/auth-data.tsx\";\nimport { faDiscord } from '@fortawesome/free-brands-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport { Button } from '../components/button';\nimport { BackendApi } from '../utils/backend-api'; // const fetchServices: PromiseFn<any> = async () => {\n// \tconst servicesResponse = await BackendApi.getServices();\n// \t// const shoppyCacheResponse = await BackendApi.getShoppyProductCache();\n// \tif (\n// \t\t!servicesResponse ||\n// \t\t!servicesResponse.data\n// \t\t// !shoppyCacheResponse ||\n// \t\t// !shoppyCacheResponse.data\n// \t)\n// \t\tthrow new Error();\n// \t// return servicesResponse.data.map((service, index) =>\n// \t// \tshoppyCacheResponse.data[index]\n// \t// \t\t? {\n// \t// \t\t\t\t...service,\n// \t// \t\t\t\tshoppyProductData: shoppyCacheResponse.data.find(\n// \t// \t\t\t\t\t(dataItem) => dataItem.id == service.shoppyProductId\n// \t// \t\t\t\t),\n// \t// \t\t  }\n// \t// \t\t: service\n// \t// );\n// \treturn servicesResponse.data;\n// };\n// const AuthDataWrapper = ({ children }) => {\n// \tconst state = useAsync({\n// \t\tpromiseFn: fetchServices,\n// \t});\n// \treturn children(state);\n// };\n\nconst AuthDataWrapper = ({\n  user,\n  permissions,\n  children\n}) => {\n  if (user && Object.keys(user).length && user.id) {\n    if (permissions && (!user.permissions || permissions.every(perm => user.permissions.includes(perm)))) {\n      return /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-screen flex flex-col items-center justify-center\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-6 bg-secondary-bg rounded-md flex flex-col items-center\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"You do not have the proper permissions to view this page.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 57,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 56,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 54,\n        columnNumber: 5\n      }, this);\n    }\n\n    return children;\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"h-screen flex flex-col items-center justify-center\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-6 bg-secondary-bg rounded-md flex flex-col items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"You are not authenticated. Access denied.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            className: \"space-x-2 flex items-center mt-4\",\n            href: \"http://localhost:3005/auth\",\n            children: [/*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n              icon: faDiscord\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Login via Discord\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 75,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 4\n    }, this);\n  }\n};\n\nconst authDataCtx = async ctx => {\n  var user = null;\n  console.log('COOKIE CTX', ctx.req.headers.cookie);\n\n  try {\n    const authInfoResponse = await BackendApi.getAuthInfo(ctx.req.headers.cookie || '').catch(() => {\n      return {\n        data: {}\n      };\n    });\n\n    if (authInfoResponse && authInfoResponse.data) {\n      user = authInfoResponse === null || authInfoResponse === void 0 ? void 0 : authInfoResponse.data;\n    }\n  } catch (e) {}\n\n  return {\n    user\n  };\n};\n\nexport { AuthDataWrapper, authDataCtx };","map":{"version":3,"sources":["/home/trevorb/Documents/VSCode Projects/trendtubes/auth/auth-data.tsx"],"names":["faDiscord","FontAwesomeIcon","React","Button","BackendApi","AuthDataWrapper","user","permissions","children","Object","keys","length","id","every","perm","includes","authDataCtx","ctx","console","log","req","headers","cookie","authInfoResponse","getAuthInfo","catch","data","e"],"mappings":";;AAAA,SAASA,SAAT,QAA0B,oCAA1B;AACA,SAASC,eAAT,QAAgC,gCAAhC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,SAASC,MAAT,QAAuB,sBAAvB;AACA,SAASC,UAAT,QAA2B,sBAA3B,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMC,eAAe,GAAG,CAAC;AACxBC,EAAAA,IADwB;AAExBC,EAAAA,WAFwB;AAGxBC,EAAAA;AAHwB,CAAD,KAQlB;AACL,MAAIF,IAAI,IAAIG,MAAM,CAACC,IAAP,CAAYJ,IAAZ,EAAkBK,MAA1B,IAAoCL,IAAI,CAACM,EAA7C,EAAiD;AAChD,QACCL,WAAW,KACV,CAACD,IAAI,CAACC,WAAN,IACAA,WAAW,CAACM,KAAZ,CAAmBC,IAAD,IAAUR,IAAI,CAACC,WAAL,CAAiBQ,QAAjB,CAA0BD,IAA1B,CAA5B,CAFU,CADZ,EAIE;AACD,0BACC;AAAM,QAAA,SAAS,EAAC,EAAhB;AAAA,+BACC;AAAK,UAAA,SAAS,EAAC,oDAAf;AAAA,iCACC;AAAK,YAAA,SAAS,EAAC,2DAAf;AAAA,mCACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,cADD;AASA;;AACD,WAAON,QAAP;AACA,GAjBD,MAiBO;AACN,wBACC;AAAM,MAAA,SAAS,EAAC,EAAhB;AAAA,6BACC;AAAK,QAAA,SAAS,EAAC,oDAAf;AAAA,+BACC;AAAK,UAAA,SAAS,EAAC,2DAAf;AAAA,kCACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADD,eAEC,QAAC,MAAD;AACC,YAAA,SAAS,EAAC,kCADX;AAEC,YAAA,IAAI,EAAC,4BAFN;AAAA,oCAIC,QAAC,eAAD;AAAiB,cAAA,IAAI,EAAER;AAAvB;AAAA;AAAA;AAAA;AAAA,oBAJD,eAKC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBALD;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFD;AAAA;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,YADD;AAgBA;AACD,CA5CD;;AA8CA,MAAMgB,WAAW,GAAG,MAAOC,GAAP,IAAoB;AACvC,MAAIX,IAAI,GAAG,IAAX;AACAY,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BF,GAAG,CAACG,GAAJ,CAAQC,OAAR,CAAgBC,MAA1C;;AACA,MAAI;AACH,UAAMC,gBAAgB,GAAG,MAAMnB,UAAU,CAACoB,WAAX,CAC9BP,GAAG,CAACG,GAAJ,CAAQC,OAAR,CAAgBC,MAAhB,IAA0B,EADI,EAE7BG,KAF6B,CAEvB,MAAM;AACb,aAAO;AAAEC,QAAAA,IAAI,EAAE;AAAR,OAAP;AACA,KAJ8B,CAA/B;;AAKA,QAAIH,gBAAgB,IAAIA,gBAAgB,CAACG,IAAzC,EAA+C;AAC9CpB,MAAAA,IAAI,GAAGiB,gBAAH,aAAGA,gBAAH,uBAAGA,gBAAgB,CAAEG,IAAzB;AACA;AACD,GATD,CASE,OAAOC,CAAP,EAAU,CAAE;;AACd,SAAO;AAAErB,IAAAA;AAAF,GAAP;AACA,CAdD;;AAgBA,SAASD,eAAT,EAA0BW,WAA1B","sourcesContent":["import { faDiscord } from '@fortawesome/free-brands-svg-icons';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport React from 'react';\nimport { PromiseFn, useAsync } from 'react-async';\nimport { Button } from '../components/button';\nimport { BackendApi } from '../utils/backend-api';\n\n// const fetchServices: PromiseFn<any> = async () => {\n// \tconst servicesResponse = await BackendApi.getServices();\n// \t// const shoppyCacheResponse = await BackendApi.getShoppyProductCache();\n// \tif (\n// \t\t!servicesResponse ||\n// \t\t!servicesResponse.data\n// \t\t// !shoppyCacheResponse ||\n// \t\t// !shoppyCacheResponse.data\n// \t)\n// \t\tthrow new Error();\n// \t// return servicesResponse.data.map((service, index) =>\n// \t// \tshoppyCacheResponse.data[index]\n// \t// \t\t? {\n// \t// \t\t\t\t...service,\n// \t// \t\t\t\tshoppyProductData: shoppyCacheResponse.data.find(\n// \t// \t\t\t\t\t(dataItem) => dataItem.id == service.shoppyProductId\n// \t// \t\t\t\t),\n// \t// \t\t  }\n// \t// \t\t: service\n// \t// );\n// \treturn servicesResponse.data;\n// };\n\n// const AuthDataWrapper = ({ children }) => {\n// \tconst state = useAsync({\n// \t\tpromiseFn: fetchServices,\n// \t});\n// \treturn children(state);\n// };\n\nconst AuthDataWrapper = ({\n\tuser,\n\tpermissions,\n\tchildren,\n}: {\n\tuser: any;\n\tpermissions?: string[];\n\tchildren: any;\n}) => {\n\tif (user && Object.keys(user).length && user.id) {\n\t\tif (\n\t\t\tpermissions &&\n\t\t\t(!user.permissions ||\n\t\t\t\tpermissions.every((perm) => user.permissions.includes(perm)))\n\t\t) {\n\t\t\treturn (\n\t\t\t\t<main className=\"\">\n\t\t\t\t\t<div className=\"h-screen flex flex-col items-center justify-center\">\n\t\t\t\t\t\t<div className=\"p-6 bg-secondary-bg rounded-md flex flex-col items-center\">\n\t\t\t\t\t\t\t<p>You do not have the proper permissions to view this page.</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</main>\n\t\t\t);\n\t\t}\n\t\treturn children;\n\t} else {\n\t\treturn (\n\t\t\t<main className=\"\">\n\t\t\t\t<div className=\"h-screen flex flex-col items-center justify-center\">\n\t\t\t\t\t<div className=\"p-6 bg-secondary-bg rounded-md flex flex-col items-center\">\n\t\t\t\t\t\t<p>You are not authenticated. Access denied.</p>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tclassName=\"space-x-2 flex items-center mt-4\"\n\t\t\t\t\t\t\thref=\"http://localhost:3005/auth\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<FontAwesomeIcon icon={faDiscord} />\n\t\t\t\t\t\t\t<span>Login via Discord</span>\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t);\n\t}\n};\n\nconst authDataCtx = async (ctx: any) => {\n\tvar user = null;\n\tconsole.log('COOKIE CTX', ctx.req.headers.cookie);\n\ttry {\n\t\tconst authInfoResponse = await BackendApi.getAuthInfo(\n\t\t\tctx.req.headers.cookie || ''\n\t\t).catch(() => {\n\t\t\treturn { data: {} };\n\t\t});\n\t\tif (authInfoResponse && authInfoResponse.data) {\n\t\t\tuser = authInfoResponse?.data;\n\t\t}\n\t} catch (e) {}\n\treturn { user };\n};\n\nexport { AuthDataWrapper, authDataCtx };\n"]},"metadata":{},"sourceType":"module"}